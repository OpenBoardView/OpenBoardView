git:
  depth: 9999999
os:
- linux
compiler:
- clang
env:
  global:
   # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
   #   via the "travis encrypt" command using the project repo's public key
   - secure: "pMMURJ/Twh548jxxJPYqTjiFYLXKmdelIwdbnAn7XXINkmziY1AUaVFvEyB7+f0pnw1/A9Cij6BzdLkbkLMJjhm6NVvOUi9nrnctmbrBAVwQqPZTWdZ00ZHJyB1RI2f2wq4+g1x8o/Nb8KV0zck7eEz1ytfID4amhWfGsdZWuALSWGMR2MTCiw1tsyHCZBdrRn3IApaOG5vc8/hrc8P0iI1hJAI5boH4VrtSsP4q/4xjwEXOZjZQQZuMWg97msCGxHfWpiSlj5JKPemK5c6oXuEkGkLGvOk9yh0RkPib4i7ByRGf5fMq5+XZ8oNGBWV1FYHWlS1Maxcb93r4n1kn+kzMT+zozRgJfjLQLtTKd9TbXEOrGTmzSsy/hsTbjcAgLZU2chcL4/j0rCJqCCd19ukXISc3yLjGa9NRNBYoimQm7mLx/x2XO1icoIskmDUnlDzx27s4eWIuDb9+nd4kuoXWafcnhzCefGHCjYz7egKOSGIMkUs2GBxKDqks1LbA96AovLLxfnvOgOzDoFivyf1Xy3F+ZAGIp7Uubx/ap68TOGqYPZvAxxMWYtGb6z3Hl1LaPpCVCX8dHZMZmWpYh+TF/wMebFCb97NxY8vLo6FduEIN0Qu/ij2EiSvkh16H5mTZwpJVG2pS7ucHl0HgGy/OWz7LzhDj+Ix0tdvskYs="
matrix:
  include:
  - os: linux
    compiler: gcc
    env: DEPLOY=yes DEPLOY_DEB=yes
  - os: linux
    compiler: gcc
    env: DEPLOY=yes DEPLOY_RPM=yes
  - os: osx
    compiler: clang
    env: DEPLOY=yes
  - os: linux
    compiler: gcc
    env: CROSS=mingw64 DEPLOY=yes
dist: trusty
sudo: required
language: cpp
before_install:
  - echo -n | openssl s_client -connect https://scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-
addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - gcc-6
    - g++-6
  coverity_scan:
    project:
      name: "techedude/OpenBoardView"
      description: "<Your project description here>"
    notification_email: sgurevich@yahoo.com
    build_command_prepend: 
    build_command:if [ "$CXX" = "g++" ]; then export CXX="g++-6" CC="gcc-6"; fi ./build.sh || exit 1
    branch_pattern: coverity_scan
install: |-
  if [ "$TRAVIS_OS_NAME" == "linux" ]
  then
    if [ "$CROSS" == "mingw64" ] # Cross compiling for Windows
    then
      sudo add-apt-repository "deb http://fr.archive.ubuntu.com/ubuntu/ xenial main restricted universe multiverse" # We need an up-to-date MinGW
      sudo apt-get update
      sudo apt-get install -t xenial gcc-mingw-w64-i686 g++-mingw-w64-i686 mingw32-runtime
      wget https://www.libsdl.org/release/SDL2-devel-2.0.4-mingw.tar.gz # Manually install the SDL2 mingw dev files
      tar -xf SDL2-devel-2.0.4-mingw.tar.gz
      pushd SDL2-2.0.4
      sudo make cross CROSS_PATH=/usr
      popd
    else
      sudo apt-get -qy install libsdl2-dev libgtk-3-dev rpm libegl1-mesa-dev libgles2-mesa-dev # Manual installation of the last 2 shouldn't be required, but it is nowâ€¦
    fi
  elif [ "$TRAVIS_OS_NAME" == "osx" ]
  then
    brew update
    brew install sdl2
  fi
script: |-
  if [ "$CXX" = "g++" ]; then export CXX="g++-6" CC="gcc-6"; fi
  ./build.sh || exit 1
  if [ "$DEPLOY_DEB" == "yes" ] || [ "$DEPLOY_RPM" == "yes" ]
  then
    pushd release_build
    make package
    popd
  fi
before_deploy: |-
  if [ "$TRAVIS_OS_NAME" == "osx" ]
  then
    export DEPLOY_FILES=$(ls OpenBoardView-*.dmg)
  elif [ "$CROSS" == "mingw64" ]
  then
    export DEPLOY_FILES=bin/openboardview.exe
  elif [ "$DEPLOY_DEB" == "yes" ]
  then
    export DEPLOY_FILES=$(ls OpenBoardView-*.deb)
  elif [ "$DEPLOY_RPM" == "yes" ]
  then
    export DEPLOY_FILES=$(ls OpenBoardView-*.rpm)
  fi
deploy:
  provider: releases
  api_key:
    secure: moFwXyAl3mTnYx2RY3kYJ9cutRaEiQrCurkwSFkPsFBqFJQpSG5ld72W1JEoQqlrJBeLEix2rtY9XRfQWGKTxuqJbdz1S7hyA5+Oo4HUYZfDkp7/nG7aIzql1G+rheSP7fbq4XAjTPyVbiYfVS/hh6RuZ/E11Zp33PdtQoenvFJYZnL/0UxN9cVmKWgE7vHzOszfuvPM21odOTyoZbUfZHZlYtR0xbY/mqoUFmcFbH+7H6pn3PINdtoycYq/TfPtxrHmLOlysWdABtbK+fdjneeg4ZaK3Rg7uAnNOrI8h5vOWuP0kj2YTc9aDmMgCeunPncTDBU3h6qL/DGN7BDzsHsBdEk9iuxX+coUe+3RQbRoy36m4RfzeEHZJNVCLu4yhZ5NzjR28QZxpfKGc9Jg8OHL9T3P2KFISjJX1bJ+d5xBbbcewe1KsAzG7zokHNEdzPMZSU5iOO+bamsjZ1SIm2dzcPjwpxSoZSL+2ZCurhZgEyKydBzRSFeDCHaifYv6rM98jZLcmDp0KZFzY07OrrgPbAoZFsICEPnpYA57VN7EPG0G7t3iGqcyCvr5E5A5ZUe7bwA3mqY1/0QPkZQQaSXeHbT45mlAEMBZRixLBgFOvCSq4U1O6cibAwBT+qQ8Xq6D3vJjhmodzwHz1aaPAlf/tm1LZguZf86TPjWrg5U=
  file_glob: true
  file: "${DEPLOY_FILES}"
  skip_cleanup: true
  on:
    tags: true
    condition: "$DEPLOY == yes"
